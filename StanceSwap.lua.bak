print("Stance Swap!");
local gStance={"Battle Stance","Defensive Stance","Berserker Stance"}

function stsw(stActive,stEvent,stReturn)
	StanceSwap(stActive,stEvent,stReturn);
end
function stev(stSpell)
	return pcall(CastSpellByName,stSpell);
end
function StanceSwap(stSwap,stSpell,stReturn)
	
end
function StanceSwapEv(stSwap,stEvent,stReturn)
	local cst=CastSpellByName 
	local stp=SpellStopCasting 
	local res=false;
	-- Проверка на отката способности в 1.5 сек(ГКД стоек)
	for i=1,#stSwap do
		_,_,_act,_=GetShapeshiftFormInfo(stSwap[i])
		s,d,_=GetShapeshiftFormCooldown(stSwap[i])
		if not _act then 
			stp()cst(gStance[stSwap])
			break;
		end;
	end	
	--???:Edit Запрет на выполнение задачи если не удалось выполнить действие.
	if stEvent==nil or(s>0 and d>0)then else 
		res=stEvent()
	end 
	if stReturn ~=nil and res then
		StanceSwap({stReturn},nil,nil);
	end;		
end